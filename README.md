# Video Lane Detection and Stabilization

This repository contains a collection of Python scripts for video processing, focusing on lane detection, vehicle tracking, and video stabilization.

## Scripts Overview

### Lane Detection and Vehicle Tracking

#### `addlanenumber.py`
This script adds lane numbers onto the input video.
- **Controls:**
  - **A**: Create a new lane
  - **C**: Delete a lane
  - **D**: Undo action
- **Output**: Generates a `.npy` file containing lane information

#### `addLaneNew.py`
This script processes vehicle data with lane information.
- **Input**: 
  - CSV file with vehicle data
  - NPY file generated by `addlanenumber.py`
- **Output**: CSV file containing vehicle data with lane information

### Video Stabilization

#### `stabCheck.py`
Checks video stability quality by monitoring selected key points.
- Automatically adjusts frames if key points movement is detected

#### `stabTest4.py` 
Automatically stabilizes drone video footage using selected markers

#### `stabilization1.py`
Stabilizes video using 5 key points (number is adjustable)


### Coordinate Transformation

#### `getM-Copy1.ipynb`
This Jupyter notebook calculates homographic matrices to convert between pixel coordinates and real-world GPS coordinates.
- **Input**: Output data from ARCIS
- **Output**: Transformation matrices for coordinate conversion


## Usage

1. First, process your video with `addlanenumber.py` to define lanes
2. Use the generated NPY file along with your vehicle data CSV in `addLaneNew.py`
3. For video stabilization, use either:
   - `stabCheck.py` for stability quality checking
   - `stabTest4.py` for automatic drone footage stabilization
   - `stabilization1.py` for manual key point-based stabilization

## Requirements

- Python 3.8.13
- OpenCV
- NumPy
- Pandas

## Workflow

The recommended workflow sequence is:

1. **Video Stabilization**
   ```
   # Stabilize the video first
   python stabilization1.py --input video.mp4 --output stable_video.mp4
   # OR use automated drone stabilization
   python stabTest4.py --input drone_video.mp4 --output stable_drone.mp4
   ```

2. **Run ARCIS**
3. # https://drive.google.com/drive/folders/1z24cl2K1nqoDpdX0JpXReeRh4KurfFX6?usp=sharing
   - Process the stabilized video through ARCIS to extract vehicle data

4. **Add Lane Numbers**
   ```
   # Define lanes on the stabilized video
   python addlanenumber.py --input stable_video.mp4
   # Process vehicle data with lane information
   python addLaneNew.py --input arcis_output.csv --lanes lanes.npy --output vehicles_with_lanes.csv
   ```

5. **Coordinate Transformation**
   ```
   # Run the Jupyter notebook to get GPS coordinates
   jupyter notebook getM-Copy1.ipynb
   ```
   - Input the ARCIS output data to calculate homographic matrices
   - Transform pixel coordinates to real-world GPS coordinates
